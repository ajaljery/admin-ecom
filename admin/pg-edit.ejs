<%- include('./partials/header') %>
<div class="wrapper">
    <%- include('./partials/sidebar') %>
    <%- include('./partials/adminHeader') %>

    <div class="page-content">
        <div class="container-fluid">
            <div class="row">
                <div class="col-12">
                    <div class="settings-panel">
                        <div class="panel-header">
                            <h3>Payment Gateways</h3>
                            <p>Manage and activate the payment provider for your store.</p>
                        </div>
                        <div class="providers-list">
                            <div class="provider-item">
                                <div class="provider-header">
                                    <div class="provider-info">
                                        <img src="https://placehold.co/120x40/6739B7/FFFFFF?text=PhonePe" alt="PhonePe Logo">
                                        <div>
                                            <h4>PhonePe</h4>
                                            <p>India's leading digital payment platform.</p>
                                        </div>
                                    </div>
                                    <div class="provider-controls">
                                        <span class="status-badge active" data-provider="phonepe">Active</span>
                                        <button type="button" class="btn btn-secondary btn-manage" data-target="phonepe-config">Manage</button>
                                    </div>
                                </div>
                                <div class="provider-config" id="phonepe-config">
                                    <form action="/admin/site-settings/payment-gateway/phonepe" method="POST">
                                        <div class="config-body">
                                            <div class="form-group"><label>Merchant ID</label><input type="text" name="phonepeMerchantId" class="form-control" placeholder="Enter your PhonePe Merchant ID"></div>
                                            <div class="form-group"><label>Salt Key</label><input type="password" name="phonepeSaltKey" class="form-control" placeholder="Enter your PhonePe Salt Key"></div>
                                        </div>
                                        <div class="config-footer">
                                            <label class="toggle-switch">
                                                <input type="checkbox" class="activation-toggle" name="isActive" value="phonepe" checked>
                                                <span class="slider"></span>
                                                <span class="label">Activate PhonePe</span>
                                            </label>
                                            <button type="submit" class="btn btn-primary">Save Changes</button>
                                        </div>
                                    </form>
                                </div>
                            </div>

                            <div class="provider-item">
                                <div class="provider-header">
                                    <div class="provider-info">
                                        <img src="https://placehold.co/120x40/02042B/FFFFFF?text=Razorpay" alt="Razorpay Logo">
                                        <div>
                                            <h4>Razorpay</h4>
                                            <p>Accept payments from customers worldwide.</p>
                                        </div>
                                    </div>
                                    <div class="provider-controls">
                                        <span class="status-badge inactive" data-provider="razorpay">Inactive</span>
                                        <button type="button" class="btn btn-secondary btn-manage" data-target="razorpay-config">Manage</button>
                                    </div>
                                </div>
                                <div class="provider-config" id="razorpay-config">
                                    <form action="/admin/site-settings/payment-gateway/razorpay" method="POST">
                                        <div class="config-body">
                                            <div class="form-group"><label>Key ID</label><input type="text" name="razorpayKeyId" class="form-control" placeholder="Enter your Razorpay Key ID"></div>
                                            <div class="form-group"><label>Key Secret</label><input type="password" name="razorpayKeySecret" class="form-control" placeholder="Enter your Razorpay Key Secret"></div>
                                        </div>
                                        <div class="config-footer">
                                            <label class="toggle-switch">
                                                <input type="checkbox" class="activation-toggle" name="isActive" value="razorpay">
                                                <span class="slider"></span>
                                                <span class="label">Activate Razorpay</span>
                                            </label>
                                            <button type="submit" class="btn btn-primary">Save Changes</button>
                                        </div>
                                    </form>
                                </div>
                            </div>

                            <div class="provider-item">
                                <div class="provider-header">
                                    <div class="provider-info">
                                        <img src="https://placehold.co/120x40/635BFF/FFFFFF?text=Stripe" alt="Stripe Logo">
                                        <div>
                                            <h4>Stripe</h4>
                                            <p>Online payment processing for internet businesses.</p>
                                        </div>
                                    </div>
                                    <div class="provider-controls">
                                        <span class="status-badge inactive" data-provider="stripe">Inactive</span>
                                        <button type="button" class="btn btn-secondary btn-manage" data-target="stripe-config">Manage</button>
                                    </div>
                                </div>
                                <div class="provider-config" id="stripe-config">
                                    <form action="/admin/site-settings/payment-gateway/stripe" method="POST">
                                        <div class="config-body">
                                            <div class="form-group"><label>Publishable Key</label><input type="text" name="stripePublishableKey" class="form-control" placeholder="Enter your Stripe Publishable Key"></div>
                                            <div class="form-group"><label>Secret Key</label><input type="password" name="stripeSecretKey" class="form-control" placeholder="Enter your Stripe Secret Key"></div>
                                        </div>
                                        <div class="config-footer">
                                            <label class="toggle-switch">
                                                <input type="checkbox" class="activation-toggle" name="isActive" value="stripe">
                                                <span class="slider"></span>
                                                <span class="label">Activate Stripe</span>
                                            </label>
                                            <button type="submit" class="btn btn-primary">Save Changes</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<%- include('./partials/footer') %>

<style>
    :root {
        --primary-color: #4f46e5;
        --primary-hover-color: #4338ca;
        --success-color: #10b981;
        --border-color: #e5e7eb;
        --card-background-color: #ffffff;
        --text-primary: #111827;
        --text-secondary: #6b7280;
        --panel-background: #f9fafb;
    }
    .page-content { padding: 1.5rem; }
    .settings-panel {
        background: var(--card-background-color);
        border: 1px solid var(--border-color);
        border-radius: 0.75rem;
        box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05), 0 2px 4px -2px rgb(0 0 0 / 0.05);
    }
    .panel-header {
        padding: 1.5rem 2rem;
        border-bottom: 1px solid var(--border-color);
    }
    .panel-header h3 { font-size: 1.25rem; font-weight: 600; margin: 0; color: var(--text-primary); }
    .panel-header p { margin: 0.25rem 0 0; color: var(--text-secondary); font-size: 0.875rem; }
    .providers-list .provider-item:not(:last-child) { border-bottom: 1px solid var(--border-color); }
    .provider-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1.5rem 2rem;
    }
    .provider-info { display: flex; align-items: center; gap: 1.5rem; }
    .provider-info img { height: 40px; }
    .provider-info h4 { font-size: 1.125rem; font-weight: 600; margin: 0; color: var(--text-primary); }
    .provider-info p { font-size: 0.875rem; margin: 0.25rem 0 0; color: var(--text-secondary); }
    .provider-controls { display: flex; align-items: center; gap: 1rem; }
    .status-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
    }
    .status-badge.active { background-color: #dcfce7; color: #166534; }
    .status-badge.inactive { background-color: #f3f4f6; color: #4b5563; }
    .provider-config {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.4s ease-in-out;
        background-color: var(--panel-background);
    }
    .provider-config.open {
        max-height: 500px; /* Adjust as needed */
    }
    .config-body { padding: 1.5rem 2rem 0 2rem; }
    .config-footer {
        padding: 1.5rem 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-top: 1px solid var(--border-color);
        margin-top: 1.5rem;
    }
    .form-group { margin-bottom: 1.25rem; }
    .form-group:last-child { margin-bottom: 0; }
    .form-group label { font-weight: 500; display: block; margin-bottom: 0.5rem; color: #374151; font-size: 0.875rem; }
    .form-control { width: 100%; padding: 0.75rem 1rem; border: 1px solid var(--border-color); border-radius: 0.5rem; font-size: 1rem; }
    .btn { padding: 0.625rem 1.5rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; border: none; font-size: 0.9rem; transition: background-color 0.2s; }
    .btn-primary { background: var(--primary-color); color: white; }
    .btn-primary:hover { background: var(--primary-hover-color); }
    .btn-secondary { background-color: var(--card-background-color); color: var(--text-primary); border: 1px solid var(--border-color); }
    .btn-secondary:hover { background-color: var(--panel-background); }

    /* Toggle Switch */
    .toggle-switch { display: flex; align-items: center; gap: 0.75rem; cursor: pointer; }
    .toggle-switch .label { font-weight: 500; color: var(--text-primary); user-select: none; }
    .toggle-switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: relative; width: 42px; height: 24px; background-color: #ccc; transition: .4s; border-radius: 24px; }
    .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
    input:checked + .slider { background-color: var(--success-color); }
    input:checked + .slider:before { transform: translateX(18px); }
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const manageButtons = document.querySelectorAll('.btn-manage');
    const activationToggles = document.querySelectorAll('.activation-toggle');
    const statusBadges = document.querySelectorAll('.status-badge');

    // Handle opening and closing the config drawers
    manageButtons.forEach(button => {
        button.addEventListener('click', () => {
            const targetId = button.dataset.target;
            const configDrawer = document.getElementById(targetId);
            const isOpen = configDrawer.classList.contains('open');

            // Close all other drawers
            document.querySelectorAll('.provider-config.open').forEach(openDrawer => {
                openDrawer.classList.remove('open');
                const openButton = document.querySelector(`.btn-manage[data-target="${openDrawer.id}"]`);
                if (openButton) openButton.textContent = 'Manage';
            });

            // Toggle the clicked drawer
            if (!isOpen) {
                configDrawer.classList.add('open');
                button.textContent = 'Close';
            } else {
                button.textContent = 'Manage';
            }
        });
    });

    // Handle the logic for the activation toggles
    activationToggles.forEach(toggle => {
        toggle.addEventListener('change', (e) => {
            const currentProvider = e.target.value;

            if (e.target.checked) {
                // When a toggle is turned ON, turn all others OFF
                activationToggles.forEach(otherToggle => {
                    if (otherToggle !== e.target) {
                        otherToggle.checked = false;
                    }
                });
            }
            updateStatusBadges();
        });
    });

    function updateStatusBadges() {
        const activeToggle = document.querySelector('.activation-toggle:checked');
        statusBadges.forEach(badge => {
            badge.classList.remove('active', 'inactive');
            if (activeToggle && badge.dataset.provider === activeToggle.value) {
                badge.classList.add('active');
                badge.textContent = 'Active';
            } else {
                badge.classList.add('inactive');
                badge.textContent = 'Inactive';
            }
        });
    }

    // Initial status on page load
    updateStatusBadges();
});
</script>